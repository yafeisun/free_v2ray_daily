# 节点重命名格式优化说明

## 🎯 优化目标

将节点重命名格式从复杂的`{Flag}{Region}_{Number}|{AI_Tag}{YT_Tag}`改为简洁的`{Flag}{Region}_{Number}`格式，使用自然数编号，确保不包含网站信息。

## 📋 修改内容

### 1. 重命名逻辑优化

#### ❌ 原格式
```
🇺🇸US_5|GPT|YT
🇭🇰HK_12|GPT
🇯🇵JP_3|GM|YT
```

#### ✅ 新格式
```
🇺🇸US_1
🇭🇰HK_1  
🇯🇵JP_1
🇺🇸US_2
🇭🇰HK_2
```

### 2. 编号方式改进

#### ❌ 原方式
- 使用端口号或从现有名称提取
- 可能出现重复编号
- 编号不连续

#### ✅ 新方式
- 每个地区独立计数
- 使用自然数序列（1, 2, 3...）
- 确保编号连续且不重复

### 3. 移除的标记

#### 已移除的标记
- **AI标记**: `GPT`, `GM`, `GPT|GM`
- **YouTube标记**: `YT`, `|YT`
- **复杂后缀**: 各种组合标记

#### 保留的标记
- **国旗**: 🇺🇸🇭🇰🇯🇵🇸🇬等
- **地区代码**: US, HK, JP, SG等
- **序号**: 1, 2, 3...

## 🔧 技术实现

### 修改的文件
```
src/cli/speedtest/test_nodes_with_subscheck.py
```

### 核心代码更改

#### 1. 地区计数器
```python
# 新增地区计数器，确保每个地区按自然数编号
region_counters = {}

# 初始化地区计数器
if region not in region_counters:
    region_counters[region] = 0

# 地区编号递增（自然数编号）
region_counters[region] += 1
region_number = region_counters[region]
```

#### 2. 简化重命名方法
```python
def _generate_node_name(self, region: str, number: int, media_info: dict) -> str:
    """生成节点名称 - 使用国旗_区域_数字格式"""
    # 国旗映射
    flags = {
        "HK": "🇭🇰", "US": "🇺🇸", "JP": "🇯🇵",
        # ... 更多国旗映射
    }
    
    flag = flags.get(region, "")
    
    # 简单格式：国旗_区域_数字
    return f"{flag}{region}_{number}"
```

#### 3. 移除媒体标记生成
- 不再生成AI标记（GPT, GM等）
- 不再生成YouTube标记（YT）
- 专注于简洁的地区和编号

## 📊 优化效果

### ✅ 命名更清晰
- **格式统一**: 所有节点使用相同命名格式
- **易于识别**: 国旗+地区+编号，一目了然
- **无冗余信息**: 去除不必要的标记和后缀

### ✅ 编号更合理
- **自然数编号**: 每个地区从1开始连续编号
- **避免重复**: 通过计数器确保不重复
- **便于管理**: 方便用户筛选和使用

### ✅ 兼容性更好
- **客户端兼容**: 简洁格式适配更多客户端
- **显示友好**: 在各种设备上都能正常显示
- **无特殊字符**: 避免|等特殊字符导致的兼容性问题

## 🔄 影响范围

### 测速工作流
- **节点重命名**: 测速完成后生成的节点使用新格式
- **nodelist.txt**: 包含新格式命名的节点

### 用户使用
- **订阅链接**: 用户获取的节点使用新命名
- **客户端显示**: 客户端中显示更简洁的节点名
- **节点筛选**: 可通过地区编号进行筛选

## 📋 示例对比

### 优化前
```
🇺🇸US_5|GPT|YT        vmess://...
🇭🇰HK_12|GPT        vmess://...
🇯🇵JP_3|GM|YT       vmess://...
🇸🇬SG_8|GPT|YT       vmess://...
```

### 优化后
```
🇺🇸US_1             vmess://...
🇭🇰HK_1             vmess://...
🇯🇵JP_1             vmess://...
🇺🇸US_2             vmess://...
🇭🇰HK_2             vmess://...
```

## 🎯 优势总结

1. **简洁明了**: 去除冗余标记，命名更简洁
2. **自然编号**: 使用连续数字，易于理解
3. **无网站信息**: 确保不包含.com等网站信息
4. **兼容性强**: 适配更多客户端和设备
5. **易于维护**: 代码逻辑更简单，便于后续修改

---

*此优化确保了节点命名的简洁性和一致性，提升了用户体验。*